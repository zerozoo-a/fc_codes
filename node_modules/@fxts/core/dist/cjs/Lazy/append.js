"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var utils_1 = require("../_internal/utils");
var concurrent_1 = tslib_1.__importStar(require("./concurrent"));
function sync(a, iterable) {
    return tslib_1.__generator(this, function (_a) {
        switch (_a.label) {
            case 0: return [5 /*yield**/, tslib_1.__values(iterable)];
            case 1:
                _a.sent();
                return [4 /*yield*/, a];
            case 2:
                _a.sent();
                return [2 /*return*/];
        }
    });
}
function asyncSequential(a, iterable) {
    var _a;
    var iterator = iterable[Symbol.asyncIterator]();
    var finished = false;
    return _a = {},
        _a[Symbol.asyncIterator] = function () {
            return this;
        },
        _a.next = function () {
            return tslib_1.__awaiter(this, void 0, void 0, function () {
                var _a, value, done;
                var _b;
                return tslib_1.__generator(this, function (_c) {
                    switch (_c.label) {
                        case 0:
                            if (finished) {
                                return [2 /*return*/, { done: true, value: undefined }];
                            }
                            return [4 /*yield*/, iterator.next()];
                        case 1:
                            _a = _c.sent(), value = _a.value, done = _a.done;
                            if (finished) {
                                return [2 /*return*/, { done: true, value: undefined }];
                            }
                            if (!done) return [3 /*break*/, 3];
                            finished = true;
                            _b = { done: false };
                            return [4 /*yield*/, a];
                        case 2: return [2 /*return*/, (_b.value = _c.sent(), _b)];
                        case 3: return [2 /*return*/, { done: done, value: value }];
                    }
                });
            });
        },
        _a;
}
function async(a, iterable) {
    var _a;
    var iterator = null;
    return _a = {},
        _a[Symbol.asyncIterator] = function () {
            return this;
        },
        _a.next = function (_concurrent) {
            return tslib_1.__awaiter(this, void 0, void 0, function () {
                return tslib_1.__generator(this, function (_a) {
                    if (iterator === null) {
                        iterator = (0, concurrent_1.isConcurrent)(_concurrent)
                            ? asyncSequential(a, (0, concurrent_1.default)(_concurrent.length, iterable))
                            : asyncSequential(a, iterable);
                    }
                    return [2 /*return*/, iterator.next(_concurrent)];
                });
            });
        },
        _a;
}
function append(a, iterable) {
    if (iterable === undefined) {
        return function (iterable) {
            return append(a, iterable);
        };
    }
    if ((0, utils_1.isAsyncIterable)(iterable)) {
        return async((0, utils_1.isPromise)(a) ? a : Promise.resolve(a), iterable);
    }
    if ((0, utils_1.isIterable)(iterable)) {
        return sync(a, iterable);
    }
    throw new TypeError("'iterable' must be type of Iterable or AsyncIterable");
}
exports.default = append;
//# sourceMappingURL=append.js.map