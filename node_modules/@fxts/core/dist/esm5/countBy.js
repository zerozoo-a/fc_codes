import { __awaiter, __generator } from "tslib.js";
import { isAsyncIterable, isIterable, isPromise } from "./_internal/utils.js";
import { AsyncFunctionException } from "./_internal/error.js";
import reduce from "./reduce.js";
function incSel(parent, k) {
    parent[k] ? parent[k]++ : (parent[k] = 1);
    return parent;
}
function countBy(f, iterable) {
    var _this = this;
    if (iterable === undefined) {
        return function (iterable) {
            return countBy(f, iterable);
        };
    }
    var obj = {};
    if (isIterable(iterable)) {
        return reduce(function (group, a) {
            var key = f(a);
            if (isPromise(key)) {
                throw new AsyncFunctionException();
            }
            return incSel(group, key);
        }, obj, iterable);
    }
    if (isAsyncIterable(iterable)) {
        return reduce(function (group, a) { return __awaiter(_this, void 0, void 0, function () {
            var key;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, f(a)];
                    case 1:
                        key = _a.sent();
                        return [2 /*return*/, incSel(group, key)];
                }
            });
        }); }, obj, iterable);
    }
    throw new TypeError("'iterable' must be type of Iterable or AsyncIterable");
}
export default countBy;
//# sourceMappingURL=countBy.js.map